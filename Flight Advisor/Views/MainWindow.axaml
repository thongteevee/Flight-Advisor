<?xml version="1.0" encoding="utf-8"?>
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:FlightAdvisor.ViewModels"
        xmlns:converters="using:FlightAdvisor.Converters"
        xmlns:ui="using:FluentAvalonia.UI.Controls"
        x:Class="FlightAdvisor.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Flight Advisor"
        Width="1400"
        Height="900"
        WindowStartupLocation="CenterScreen"
        TransparencyLevelHint="AcrylicBlur">

	<Window.Resources>
		<converters:BoolToChevronConverter x:Key="BoolToChevronConverter"/>
	</Window.Resources>

	<Window.Styles>
		<!-- Dark Mode Theme (Default) -->
		<Style Selector="Window">
			<Style.Resources>
				<SolidColorBrush x:Key="AppBackground" Color="#0a0e1a"/>
				<SolidColorBrush x:Key="AppGradient1" Color="#0a0e1a"/>
				<SolidColorBrush x:Key="AppGradient2" Color="#1e293b"/>
				<SolidColorBrush x:Key="AppSurface" Color="#0f172a"/>
				<SolidColorBrush x:Key="AppSurface2" Color="#1e293b"/>
				<SolidColorBrush x:Key="AppBorder" Color="#334155"/>
				<SolidColorBrush x:Key="AppText" Color="#e0e7ff"/>
				<SolidColorBrush x:Key="AppTextSecondary" Color="#c7d2fe"/>
				<SolidColorBrush x:Key="AppTextTertiary" Color="#94a3b8"/>
				<SolidColorBrush x:Key="AppTextQuaternary" Color="#64748b"/>
				<SolidColorBrush x:Key="ThemeButtonBg" Color="#1e293b"/>
				<SolidColorBrush x:Key="ThemeButtonBorder" Color="#334155"/>
			</Style.Resources>
		</Style>

		<!-- Light Mode Theme Override -->
		<Style Selector="Window[RequestedThemeVariant=Light]">
			<Style.Resources>
				<!--Dirty quick patch-->
				<SolidColorBrush x:Key="AppBackground" Color="#0a0e1a"/>
				<SolidColorBrush x:Key="AppGradient1" Color="#0a0e1a"/>
				<SolidColorBrush x:Key="AppGradient2" Color="#1e293b"/>
				<SolidColorBrush x:Key="AppSurface" Color="#0f172a"/>
				<SolidColorBrush x:Key="AppSurface2" Color="#1e293b"/>
				<SolidColorBrush x:Key="AppBorder" Color="#334155"/>
				<SolidColorBrush x:Key="AppText" Color="#e0e7ff"/>
				<SolidColorBrush x:Key="AppTextSecondary" Color="#c7d2fe"/>
				<SolidColorBrush x:Key="AppTextTertiary" Color="#94a3b8"/>
				<SolidColorBrush x:Key="AppTextQuaternary" Color="#64748b"/>
				<SolidColorBrush x:Key="ThemeButtonBg" Color="#1e293b"/>
				<SolidColorBrush x:Key="ThemeButtonBorder" Color="#334155"/>
				<!--
				<SolidColorBrush x:Key="AppBackground" Color="#f8fafc"/>
				<SolidColorBrush x:Key="AppGradient1" Color="#f8fafc"/>
				<SolidColorBrush x:Key="AppGradient2" Color="#e2e8f0"/>
				<SolidColorBrush x:Key="AppSurface" Color="#ffffff"/>
				<SolidColorBrush x:Key="AppSurface2" Color="#f1f5f9"/>
				<SolidColorBrush x:Key="AppBorder" Color="#cbd5e1"/>
				<SolidColorBrush x:Key="AppText" Color="#0f172a"/>
				<SolidColorBrush x:Key="AppTextSecondary" Color="#334155"/>
				<SolidColorBrush x:Key="AppTextTertiary" Color="#64748b"/>
				<SolidColorBrush x:Key="AppTextQuaternary" Color="#94a3b8"/>
				<SolidColorBrush x:Key="ThemeButtonBg" Color="#e2e8f0"/>
				<SolidColorBrush x:Key="ThemeButtonBorder" Color="#cbd5e1"/>
				-->
			</Style.Resources>
		</Style>

		<Style Selector="TextBlock.header">
			<Setter Property="FontSize" Value="24"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="{DynamicResource AppText}"/>
		</Style>

		<Style Selector="TextBlock.subheader">
			<Setter Property="FontSize" Value="16"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="Foreground" Value="{DynamicResource AppTextSecondary}"/>
		</Style>

		<Style Selector="TextBlock.label">
			<Setter Property="FontSize" Value="12"/>
			<Setter Property="Foreground" Value="{DynamicResource AppTextTertiary}"/>
			<Setter Property="Margin" Value="0,0,0,4"/>
		</Style>

		<Style Selector="Button.primary">
			<Setter Property="Background" Value="#4f46e5"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="Padding" Value="24,12"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="FontSize" Value="15"/>
		</Style>

		<Style Selector="Button.primary:pointerover">
			<Setter Property="Background" Value="#6366f1"/>
		</Style>

		<Style Selector="Button.secondary">
			<Setter Property="Background" Value="{DynamicResource AppSurface2}"/>
			<Setter Property="Foreground" Value="{DynamicResource AppText}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource AppBorder}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="16,8"/>
			<Setter Property="CornerRadius" Value="6"/>
		</Style>

		<!-- Background gradient theme switching -->
		<Style Selector="Border#BackgroundGradient">
			<Setter Property="Background">
				<LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
					<GradientStop Color="#0a0e1a" Offset="0"/>
					<GradientStop Color="#1e293b" Offset="1"/>
				</LinearGradientBrush>
			</Setter>
		</Style>

		<Style Selector="Window[RequestedThemeVariant=Light] Border#BackgroundGradient">
			<Setter Property="Background">
				<LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
					<GradientStop Color="#f8fafc" Offset="0"/>
					<GradientStop Color="#e2e8f0" Offset="1"/>
				</LinearGradientBrush>
			</Setter>
		</Style>
	</Window.Styles>

	<!-- Main Grid -->
	<Grid>
		<!-- Background with gradient -->
		<Border Name="BackgroundGradient">
		</Border>

		<!-- Main Content with fade-in animation -->
		<Grid Margin="40" Name="MainContent">
			<Grid.Styles>
				<Style Selector="Grid#MainContent">
					<Style.Animations>
						<Animation Duration="0:0:0.8" FillMode="Forward">
							<KeyFrame Cue="0%">
								<Setter Property="Opacity" Value="0"/>
								<Setter Property="TranslateTransform.Y" Value="20"/>
							</KeyFrame>
							<KeyFrame Cue="100%">
								<Setter Property="Opacity" Value="1"/>
								<Setter Property="TranslateTransform.Y" Value="0"/>
							</KeyFrame>
						</Animation>
					</Style.Animations>
				</Style>
			</Grid.Styles>

			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- Header -->
			<StackPanel Grid.Row="0" Margin="0,0,0,30">
				<TextBlock Classes="header" Text="Flight Advisor"/>
				<TextBlock Classes="subheader"
                          Text="Should I Go Flying Today?"
                          Margin="0,8,0,0"
                          Opacity="0.8"/>
			</StackPanel>

			<!-- Main Input/Output Area -->
			<Grid Grid.Row="1">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="400"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<!-- Left Panel - Input -->
				<Border Grid.Column="0"
                       Background="{DynamicResource AppSurface}"
                       CornerRadius="12"
                       Padding="24"
                       BoxShadow="0 4 20 0 #00000040">

					<Grid RowDefinitions="*,Auto">
						<!-- Scrollable Input Section -->
						<ScrollViewer Grid.Row="0">
							<StackPanel Spacing="20">

								<!-- Flight Type Selection -->
								<StackPanel Spacing="12">
									<TextBlock Text="Flight Type"
									           FontSize="14"
									           FontWeight="SemiBold"
									           Foreground="{DynamicResource AppText}"/>

									<ComboBox ItemsSource="{Binding FlightTypes}"
									          SelectedItem="{Binding SelectedFlightType}"
									          PlaceholderText="Select flight type"
									          HorizontalAlignment="Stretch"
									          Background="{DynamicResource AppSurface2}"
									          Foreground="{DynamicResource AppText}"
									          BorderBrush="{DynamicResource AppBorder}"
									          Padding="12"
									          Height="44"/>
								</StackPanel>

								<!-- Aircraft Selection -->
								<StackPanel Spacing="12">
									<TextBlock Text="Aircraft"
									           FontSize="14"
									           FontWeight="SemiBold"
									           Foreground="{DynamicResource AppText}"/>

									<ComboBox ItemsSource="{Binding AllAircraft}"
									          SelectedItem="{Binding SelectedAircraft}"
									          PlaceholderText="Select aircraft"
									          HorizontalAlignment="Stretch"
									          Background="{DynamicResource AppSurface2}"
									          Foreground="{DynamicResource AppText}"
									          BorderBrush="{DynamicResource AppBorder}"
									          Padding="12"
									          Height="44">
										<ComboBox.ItemTemplate>
											<DataTemplate>
												<TextBlock Text="{Binding Name}"/>
											</DataTemplate>
										</ComboBox.ItemTemplate>
									</ComboBox>
								</StackPanel>

								<!-- Airport Codes -->
								<Grid ColumnDefinitions="*,*,*" ColumnSpacing="16">
									<StackPanel Grid.Column="0" Spacing="8">
										<TextBlock Text="Departure"
										           FontSize="13"
										           Foreground="{DynamicResource AppTextTertiary}"/>
										<TextBox Text="{Binding DepartureIcao}"
										         Watermark="KJFK"
										         MaxLength="4"
										         Background="{DynamicResource AppSurface2}"
										         Foreground="{DynamicResource AppText}"
										         BorderBrush="{DynamicResource AppBorder}"
										         Padding="12"
										         Height="44"
										         FontSize="14"
										         VerticalContentAlignment="Center"/>
									</StackPanel>

									<StackPanel Grid.Column="1" Spacing="8">
										<TextBlock Text="Arrival (Opt)"
										           FontSize="13"
										           Foreground="{DynamicResource AppTextTertiary}"/>
										<TextBox Text="{Binding ArrivalIcao}"
										         Watermark="KEWR"
										         MaxLength="4"
										         Background="{DynamicResource AppSurface2}"
										         Foreground="{DynamicResource AppText}"
										         BorderBrush="{DynamicResource AppBorder}"
										         Padding="12"
										         Height="44"
										         FontSize="14"
										         VerticalContentAlignment="Center"/>
									</StackPanel>

									<StackPanel Grid.Column="2" Spacing="8">
										<TextBlock Text="Alternate (Opt)"
										           FontSize="13"
										           Foreground="{DynamicResource AppTextTertiary}"/>
										<TextBox Text="{Binding AlternateIcao}"
										         Watermark="KLGA"
										         MaxLength="4"
										         Background="{DynamicResource AppSurface2}"
										         Foreground="{DynamicResource AppText}"
										         BorderBrush="{DynamicResource AppBorder}"
										         Padding="12"
										         Height="44"
										         FontSize="14"
										         VerticalContentAlignment="Center"/>
									</StackPanel>
								</Grid>

								<Border Background="{DynamicResource AppSurface2}"
								        CornerRadius="8"
								        Padding="20"
								        BorderBrush="{DynamicResource AppBorder}"
								        BorderThickness="1">
									<StackPanel Spacing="16">

										<Grid ColumnDefinitions="*,Auto">
											<TextBlock Grid.Column="0"
											           Text="Flight Details (Optional)"
											           FontSize="16"
											           FontWeight="SemiBold"
											           Foreground="{DynamicResource AppText}"
											           VerticalAlignment="Center"/>

											<Button Grid.Column="1"
											        Click="ToggleFlightDetails_Click"
											        Background="Transparent"
											        BorderThickness="0"
											        Foreground="{DynamicResource AppTextTertiary}"
											        FontSize="20"
											        Padding="8"
											        Cursor="Hand">
												<TextBlock Text="{Binding ShowFlightDetails, Converter={StaticResource BoolToChevronConverter}}"/>
											</Button>
										</Grid>

										<StackPanel Spacing="16" IsVisible="{Binding ShowFlightDetails}">

											<Grid ColumnDefinitions="*,*,*" ColumnSpacing="16">
												<StackPanel Grid.Column="0" Spacing="8">
													<TextBlock Text="Takeoff Weight"
													           FontSize="13"
													           Foreground="{DynamicResource AppTextTertiary}"/>
													<NumericUpDown Value="{Binding TakeoffWeight}"
													               Minimum="0"
													               Maximum="999999"
													               Watermark="0"
													               Background="{DynamicResource AppSurface}"
													               Foreground="{DynamicResource AppText}"
													               BorderBrush="{DynamicResource AppBorder}"
													               Padding="12"
													               Height="44"/>
												</StackPanel>

												<StackPanel Grid.Column="1" Spacing="8">
													<TextBlock Text="Landing Weight"
													           FontSize="13"
													           Foreground="{DynamicResource AppTextTertiary}"/>
													<NumericUpDown Value="{Binding LandingWeight}"
													               Minimum="0"
													               Maximum="999999"
													               Watermark="0"
													               Background="{DynamicResource AppSurface}"
													               Foreground="{DynamicResource AppText}"
													               BorderBrush="{DynamicResource AppBorder}"
													               Padding="12"
													               Height="44"/>
												</StackPanel>

												<StackPanel Grid.Column="2" Spacing="8">
													<TextBlock Text="Souls on Board"
													           FontSize="13"
													           Foreground="{DynamicResource AppTextTertiary}"/>
													<NumericUpDown Value="{Binding SoulsOnBoard}"
													               Minimum="0"
													               Maximum="999"
													               Watermark="0"
													               Background="{DynamicResource AppSurface}"
													               Foreground="{DynamicResource AppText}"
													               BorderBrush="{DynamicResource AppBorder}"
													               Padding="12"
													               Height="44"/>
												</StackPanel>
											</Grid>

											<StackPanel Spacing="8">
												<TextBlock Text="Fuel Planned (gal)"
												           FontSize="13"
												           Foreground="{DynamicResource AppTextTertiary}"/>
												<NumericUpDown Value="{Binding FuelPlanned}"
												               Minimum="0"
												               Maximum="99999"
												               Watermark="0.0"
												               FormatString="F1"
												               Background="{DynamicResource AppSurface}"
												               Foreground="{DynamicResource AppText}"
												               BorderBrush="{DynamicResource AppBorder}"
												               Padding="12"
												               Height="44"/>
											</StackPanel>

											<StackPanel Spacing="8">
												<TextBlock Text="Route"
												           FontSize="13"
												           Foreground="{DynamicResource AppTextTertiary}"/>
												<TextBox Text="{Binding Route}"
												         Watermark="DCT or specify waypoints"
												         AcceptsReturn="True"
												         TextWrapping="Wrap"
												         MinHeight="100"
												         Background="{DynamicResource AppSurface}"
												         Foreground="{DynamicResource AppText}"
												         BorderBrush="{DynamicResource AppBorder}"
												         Padding="12"
												         FontSize="14"
												         VerticalAlignment="Top"/>
											</StackPanel>

											<TextBlock Text="Runway selections will be used for crosswind calculations"
											           FontSize="12"
											           Foreground="{DynamicResource AppTextQuaternary}"
											           TextAlignment="Center"
											           Margin="0,8,0,0"/>
										</StackPanel>
									</StackPanel>
								</Border>

							</StackPanel>
						</ScrollViewer>

						<!-- BOTTOM SECTION - CHECK WEATHER BUTTON -->
						<StackPanel Grid.Row="1" Spacing="12" Margin="0,20,0,0">
							<!-- Check Weather Button -->
							<Button Content="Check Weather Conditions"
									Click="CheckWeather_Click"
									HorizontalAlignment="Stretch"
									Height="48"
									FontSize="16"
									FontWeight="SemiBold"
									Background="#4f46e5"
									Foreground="White"
									CornerRadius="8"
									Cursor="Hand"
									IsVisible="{Binding DepartureIcao, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
								<Button.Styles>
									<Style Selector="Button:pointerover">
										<Setter Property="Background" Value="#4338ca"/>
									</Style>
									<Style Selector="Button:pressed">
										<Setter Property="Background" Value="#3730a3"/>
									</Style>
								</Button.Styles>
							</Button>
						</StackPanel>
					</Grid>
				</Border>

				<!-- Right Panel - Results -->
				<Border Grid.Column="1"
                       Margin="24,0,0,0"
                       Background="{DynamicResource AppSurface}"
                       CornerRadius="12"
                       Padding="32"
                       BoxShadow="0 4 20 0 #00000040">

					<Grid>
						<!-- Loading State -->
						<StackPanel HorizontalAlignment="Center"
								   VerticalAlignment="Center"
								   IsVisible="{Binding IsLoading}"
								   Spacing="16">
							<ui:ProgressRing IsActive="True" Width="48" Height="48"/>
							<TextBlock Text="Fetching weather data..."
									  Classes="subheader"
									  HorizontalAlignment="Center"/>
						</StackPanel>

						<!-- Error State -->
						<Border IsVisible="{Binding HasError}"
        Background="#1a1625"
        BorderBrush="#dc2626"
        BorderThickness="2"
        CornerRadius="16"
        Padding="32"
        BoxShadow="0 8 32 0 #00000060"
        MaxWidth="600"
        VerticalAlignment="Center"
        HorizontalAlignment="Center">

							<Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto">

								<!-- Error Icon with Animation -->
								<Viewbox Width="80" Height="80"
										 Grid.Row="0"
										 HorizontalAlignment="Center"
										 Margin="0,0,0,24"
										 Name="ErrorIconDisplay">
									<Viewbox.Styles>
										<Style Selector="Viewbox#ErrorIconDisplay">
											<Style.Animations>
												<Animation Duration="0:0:2" IterationCount="Infinite">
													<KeyFrame Cue="0%">
														<Setter Property="ScaleTransform.ScaleX" Value="1"/>
														<Setter Property="ScaleTransform.ScaleY" Value="1"/>
														<Setter Property="Opacity" Value="1"/>
													</KeyFrame>
													<KeyFrame Cue="50%">
														<Setter Property="ScaleTransform.ScaleX" Value="1.1"/>
														<Setter Property="ScaleTransform.ScaleY" Value="1.1"/>
														<Setter Property="Opacity" Value="0.8"/>
													</KeyFrame>
													<KeyFrame Cue="100%">
														<Setter Property="ScaleTransform.ScaleX" Value="1"/>
														<Setter Property="ScaleTransform.ScaleY" Value="1"/>
														<Setter Property="Opacity" Value="1"/>
													</KeyFrame>
												</Animation>
											</Style.Animations>
										</Style>
									</Viewbox.Styles>
									<Canvas Width="100" Height="100">
										<Ellipse Width="100" Height="100"
												 Fill="#dc2626"
												 Opacity="0.2"/>
										<Path Fill="#dc2626"
											  Data="M50,25 L75,65 L25,65 Z"
											  Stroke="#dc2626"
											  StrokeThickness="3"/>
										<Rectangle Width="4" Height="18"
												   Canvas.Left="48" Canvas.Top="38"
												   Fill="White"
												   RadiusX="2" RadiusY="2"/>
										<Ellipse Width="5" Height="5"
												 Canvas.Left="47.5" Canvas.Top="58"
												 Fill="White"/>
									</Canvas>
								</Viewbox>

								<!-- Error Title -->
								<TextBlock Grid.Row="1"
										   Text="Unable to Fetch Weather Data"
										   FontSize="24"
										   FontWeight="Bold"
										   Foreground="#dc2626"
										   HorizontalAlignment="Center"
										   Margin="0,0,0,16"/>

								<!-- Error Message Box -->
								<Border Grid.Row="2"
										Background="#fee2e2"
										CornerRadius="8"
										Padding="16"
										Margin="0,0,0,20">
									<TextBlock Text="{Binding ErrorMessage}"
											   TextWrapping="Wrap"
											   Foreground="#991b1b"
											   FontSize="14"
											   LineHeight="20"
											   TextAlignment="Center"/>
								</Border>

								<!-- Troubleshooting Tips -->
								<Border Grid.Row="3"
										Background="{DynamicResource AppSurface2}"
										BorderBrush="{DynamicResource AppBorder}"
										BorderThickness="1"
										CornerRadius="12"
										Padding="20"
										Margin="0,0,0,24">
									<StackPanel Spacing="12">
										<TextBlock Text="&#x1F4A1; Troubleshooting Tips"
												   FontSize="16"
												   FontWeight="SemiBold"
												   Foreground="{DynamicResource AppText}"
												   Margin="0,0,0,8"/>

										<StackPanel Orientation="Horizontal" Spacing="12">
											<TextBlock Text="&#x2708;&#xFE0F;" FontSize="20" VerticalAlignment="Top" Margin="0,2,0,0"/>
											<TextBlock TextWrapping="Wrap"
													   Foreground="{DynamicResource AppTextSecondary}"
													   FontSize="13"
													   LineHeight="18">
												<Run FontWeight="SemiBold">Check ICAO Code:</Run>
												<Run Text=" Ensure you're using the correct 4-letter ICAO code (e.g., KJFK, KSFO, KEWR)"/>
											</TextBlock>
										</StackPanel>

										<StackPanel Orientation="Horizontal" Spacing="12">
											<TextBlock Text="&#x1F310;" FontSize="20" VerticalAlignment="Top" Margin="0,2,0,0"/>
											<TextBlock TextWrapping="Wrap"
													   Foreground="{DynamicResource AppTextSecondary}"
													   FontSize="13"
													   LineHeight="18">
												<Run FontWeight="SemiBold">Network Connection:</Run>
												<Run Text=" Verify your internet connection is stable and active"/>
											</TextBlock>
										</StackPanel>

										<StackPanel Orientation="Horizontal" Spacing="12">
											<TextBlock Text="&#x1F504;" FontSize="20" VerticalAlignment="Top" Margin="0,2,0,0"/>
											<TextBlock TextWrapping="Wrap"
													   Foreground="{DynamicResource AppTextSecondary}"
													   FontSize="13"
													   LineHeight="18">
												<Run FontWeight="SemiBold">API Status:</Run>
												<Run Text=" The NOAA service may be temporarily unavailable. Try again in a few moments"/>
											</TextBlock>
										</StackPanel>

										<StackPanel Orientation="Horizontal" Spacing="12">
											<TextBlock Text="&#x1F4CD;" FontSize="20" VerticalAlignment="Top" Margin="0,2,0,0"/>
											<TextBlock TextWrapping="Wrap"
													   Foreground="{DynamicResource AppTextSecondary}"
													   FontSize="13"
													   LineHeight="18">
												<Run FontWeight="SemiBold">Small Airports:</Run>
												<Run Text=" Some smaller airports may not report weather. Try a nearby larger airport"/>
											</TextBlock>
										</StackPanel>
									</StackPanel>
								</Border>

								<!-- Action Buttons -->
								<StackPanel Grid.Row="4"
											Orientation="Horizontal"
											HorizontalAlignment="Center"
											Spacing="12">

									<Button Command="{Binding RetryCommand}"
											Height="44"
											Padding="24,0"
											CornerRadius="8"
											FontWeight="SemiBold"
											FontSize="14"
											Background="#4f46e5"
											Foreground="White"
											Cursor="Hand">
										<Button.Styles>
											<Style Selector="Button:pointerover">
												<Setter Property="Background" Value="#4338ca"/>
											</Style>
										</Button.Styles>
										<StackPanel Orientation="Horizontal" Spacing="6">
											<TextBlock Text="&#x1F504;" FontSize="16" VerticalAlignment="Center"/>
											<TextBlock Text="Try Again" VerticalAlignment="Center"/>
										</StackPanel>
									</Button>

									<Button Content="Clear"
											Command="{Binding ClearErrorCommand}"
											Height="44"
											Padding="24,0"
											CornerRadius="8"
											FontWeight="SemiBold"
											FontSize="14"
											Background="{DynamicResource AppSurface2}"
											Foreground="{DynamicResource AppText}"
											BorderBrush="{DynamicResource AppBorder}"
											BorderThickness="1"
											Cursor="Hand">
										<Button.Styles>
											<Style Selector="Button:pointerover">
												<Setter Property="Background" Value="#334155"/>
											</Style>
										</Button.Styles>
									</Button>
								</StackPanel>

							</Grid>
						</Border>

						<!-- PopularAirportsHelper.axaml - UserControl with Unicode -->
						<UserControl xmlns="https://github.com/avaloniaui"
									 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
									 x:Class="FlightAdvisor.Views.PopularAirportsHelper">

							<Border Background="{DynamicResource AppSurface2}"
									BorderBrush="{DynamicResource AppBorder}"
									BorderThickness="1"
									CornerRadius="12"
									Padding="20">

								<StackPanel Spacing="16">
									<TextBlock Text="&#x1F5FA;&#xFE0F; Try These Popular Airports"
											   FontSize="16"
											   FontWeight="SemiBold"
											   Foreground="{DynamicResource AppText}"/>

									<Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="8">

										<!-- Row 1 -->
										<Button Grid.Row="0" Grid.Column="0"
												Content="KJFK - New York JFK"
												Command="{Binding QuickSelectAirportCommand}"
												CommandParameter="KJFK"
												HorizontalAlignment="Stretch"
												HorizontalContentAlignment="Left"
												Height="40"
												Padding="12"
												Background="{DynamicResource AppSurface}"
												Foreground="{DynamicResource AppText}"
												BorderBrush="{DynamicResource AppBorder}"
												BorderThickness="1"
												CornerRadius="6"
												Cursor="Hand">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#4f46e5"/>
													<Setter Property="Foreground" Value="White"/>
												</Style>
											</Button.Styles>
										</Button>

										<Button Grid.Row="0" Grid.Column="1"
												Content="KSFO - San Francisco"
												Command="{Binding QuickSelectAirportCommand}"
												CommandParameter="KSFO"
												HorizontalAlignment="Stretch"
												HorizontalContentAlignment="Left"
												Height="40"
												Padding="12"
												Background="{DynamicResource AppSurface}"
												Foreground="{DynamicResource AppText}"
												BorderBrush="{DynamicResource AppBorder}"
												BorderThickness="1"
												CornerRadius="6"
												Cursor="Hand">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#4f46e5"/>
													<Setter Property="Foreground" Value="White"/>
												</Style>
											</Button.Styles>
										</Button>

										<!-- Row 2 -->
										<Button Grid.Row="1" Grid.Column="0"
												Content="KLAX - Los Angeles"
												Command="{Binding QuickSelectAirportCommand}"
												CommandParameter="KLAX"
												HorizontalAlignment="Stretch"
												HorizontalContentAlignment="Left"
												Height="40"
												Padding="12"
												Background="{DynamicResource AppSurface}"
												Foreground="{DynamicResource AppText}"
												BorderBrush="{DynamicResource AppBorder}"
												BorderThickness="1"
												CornerRadius="6"
												Cursor="Hand">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#4f46e5"/>
													<Setter Property="Foreground" Value="White"/>
												</Style>
											</Button.Styles>
										</Button>

										<Button Grid.Row="1" Grid.Column="1"
												Content="KORD - Chicago O'Hare"
												Command="{Binding QuickSelectAirportCommand}"
												CommandParameter="KORD"
												HorizontalAlignment="Stretch"
												HorizontalContentAlignment="Left"
												Height="40"
												Padding="12"
												Background="{DynamicResource AppSurface}"
												Foreground="{DynamicResource AppText}"
												BorderBrush="{DynamicResource AppBorder}"
												BorderThickness="1"
												CornerRadius="6"
												Cursor="Hand">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#4f46e5"/>
													<Setter Property="Foreground" Value="White"/>
												</Style>
											</Button.Styles>
										</Button>

										<!-- Row 3 -->
										<Button Grid.Row="2" Grid.Column="0"
												Content="KATL - Atlanta"
												Command="{Binding QuickSelectAirportCommand}"
												CommandParameter="KATL"
												HorizontalAlignment="Stretch"
												HorizontalContentAlignment="Left"
												Height="40"
												Padding="12"
												Background="{DynamicResource AppSurface}"
												Foreground="{DynamicResource AppText}"
												BorderBrush="{DynamicResource AppBorder}"
												BorderThickness="1"
												CornerRadius="6"
												Cursor="Hand">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#4f46e5"/>
													<Setter Property="Foreground" Value="White"/>
												</Style>
											</Button.Styles>
										</Button>

										<Button Grid.Row="2" Grid.Column="1"
												Content="KDFW - Dallas/Fort Worth"
												Command="{Binding QuickSelectAirportCommand}"
												CommandParameter="KDFW"
												HorizontalAlignment="Stretch"
												HorizontalContentAlignment="Left"
												Height="40"
												Padding="12"
												Background="{DynamicResource AppSurface}"
												Foreground="{DynamicResource AppText}"
												BorderBrush="{DynamicResource AppBorder}"
												BorderThickness="1"
												CornerRadius="6"
												Cursor="Hand">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#4f46e5"/>
													<Setter Property="Foreground" Value="White"/>
												</Style>
											</Button.Styles>
										</Button>

									</Grid>

									<TextBlock Text="Click any airport to automatically fetch its weather"
											   FontSize="11"
											   Foreground="{DynamicResource AppTextQuaternary}"
											   HorizontalAlignment="Center"
											   FontStyle="Italic"/>
								</StackPanel>
							</Border>
						</UserControl>

						<!-- Results Display -->
						<ScrollViewer IsVisible="{Binding ShowResults}">
							<StackPanel Spacing="24">

								<!-- Airport Switcher Buttons -->
								<StackPanel Orientation="Horizontal"
								            Spacing="12"
								            Margin="0,0,0,16"
								            HorizontalAlignment="Left">

									<!-- Departure Button -->
									<Button Click="SwitchToDeparture_Click"
									        Height="44"
									        Padding="24,0"
									        CornerRadius="8"
									        FontWeight="SemiBold"
									        FontSize="14"
									        Cursor="Hand">
										<Button.Styles>
											<Style Selector="Button">
												<Setter Property="Background" Value="{DynamicResource AppSurface2}"/>
												<Setter Property="Foreground" Value="{DynamicResource AppText}"/>
												<Setter Property="BorderBrush" Value="{DynamicResource AppBorder}"/>
												<Setter Property="BorderThickness" Value="1"/>
											</Style>
											<Style Selector="Button:pointerover">
												<Setter Property="Background" Value="#6366f1"/>
												<Setter Property="Foreground" Value="White"/>
												<Setter Property="BorderBrush" Value="#4f46e5"/>
											</Style>
										</Button.Styles>
										<StackPanel Orientation="Horizontal" Spacing="8">
											<TextBlock Text="&#x2708;&#xFE0F;" FontSize="18"/>
											<TextBlock Text="Departure"/>
										</StackPanel>
									</Button>

									<!-- Arrival Button -->
									<Button Click="SwitchToArrival_Click"
									        Height="44"
									        Padding="24,0"
									        CornerRadius="8"
									        FontWeight="SemiBold"
									        FontSize="14"
									        Cursor="Hand"
									        IsVisible="{Binding ShowArrivalButton}">
										<Button.Styles>
											<Style Selector="Button">
												<Setter Property="Background" Value="{DynamicResource AppSurface2}"/>
												<Setter Property="Foreground" Value="{DynamicResource AppText}"/>
												<Setter Property="BorderBrush" Value="{DynamicResource AppBorder}"/>
												<Setter Property="BorderThickness" Value="1"/>
											</Style>
											<Style Selector="Button:pointerover">
												<Setter Property="Background" Value="#6366f1"/>
												<Setter Property="Foreground" Value="White"/>
												<Setter Property="BorderBrush" Value="#4f46e5"/>
											</Style>
										</Button.Styles>
										<StackPanel Orientation="Horizontal" Spacing="8">
											<TextBlock Text="&#x1F6EC;" FontSize="18"/>
											<TextBlock Text="Arrival"/>
										</StackPanel>
									</Button>

									<!-- Alternate Button -->
									<Button Click="SwitchToAlternate_Click"
									        Height="44"
									        Padding="24,0"
									        CornerRadius="8"
									        FontWeight="SemiBold"
									        FontSize="14"
									        Cursor="Hand"
									        IsVisible="{Binding ShowAlternateButton}">
										<Button.Styles>
											<Style Selector="Button">
												<Setter Property="Background" Value="{DynamicResource AppSurface2}"/>
												<Setter Property="Foreground" Value="{DynamicResource AppText}"/>
												<Setter Property="BorderBrush" Value="{DynamicResource AppBorder}"/>
												<Setter Property="BorderThickness" Value="1"/>
											</Style>
											<Style Selector="Button:pointerover">
												<Setter Property="Background" Value="#6366f1"/>
												<Setter Property="Foreground" Value="White"/>
												<Setter Property="BorderBrush" Value="#4f46e5"/>
											</Style>
										</Button.Styles>
										<StackPanel Orientation="Horizontal" Spacing="8">
											<TextBlock Text="&#x1F504;" FontSize="18"/>
											<TextBlock Text="Alternate"/>
										</StackPanel>
									</Button>
								</StackPanel>

								<!-- Decision Header -->
								<Border CornerRadius="12" Padding="24">
									<Border.Background>
										<SolidColorBrush Color="{Binding CurrentDecision.Decision, Converter={StaticResource DecisionToColorConverter}}"/>
									</Border.Background>

									<StackPanel Spacing="12">
										<TextBlock Text="{Binding CurrentDecision.Decision, Converter={StaticResource DecisionToTextConverter}}"
												  FontSize="28"
												  FontWeight="Bold"
												  Foreground="White"/>
										<TextBlock Text="{Binding CurrentDecision.Summary}"
												  FontSize="16"
												  Foreground="White"
												  Opacity="0.95"
												  TextWrapping="Wrap"/>
									</StackPanel>
								</Border>


								<!-- Weather Summary -->
								<Border Background="{DynamicResource AppSurface2}"
									   CornerRadius="10"
									   Padding="20">
									<StackPanel Spacing="16">
										<StackPanel Orientation="Horizontal" Spacing="12">
											<TextBlock Text="Airport:" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource AppText}"/>
											<TextBlock Classes="subheader"
													  Text="{Binding WeatherSummary.AirportName}"
													  VerticalAlignment="Center"/>
											<TextBlock Text="{Binding WeatherSummary.AirportIcao, StringFormat='({0})'}"
													  Foreground="{DynamicResource AppTextTertiary}"
													  VerticalAlignment="Center"/>
										</StackPanel>

										<Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="20" RowSpacing="12">
											<StackPanel Grid.Row="0" Grid.Column="0">
												<TextBlock Classes="label" Text="TEMPERATURE"/>
												<TextBlock Text="{Binding WeatherSummary.Temperature, StringFormat='{}{0:F1}&#xB0;C'}"
														  FontSize="24"
														  FontWeight="SemiBold"
														  Foreground="{DynamicResource AppText}"/>
											</StackPanel>

											<StackPanel Grid.Row="0" Grid.Column="1">
												<TextBlock Classes="label" Text="WIND"/>
												<TextBlock FontSize="20" Foreground="{DynamicResource AppText}">
													<Run Text="{Binding WeatherSummary.WindDirection, StringFormat='{}{0}&#xB0;'}"/>
													<Run Text=" at "/>
													<Run Text="{Binding WeatherSummary.WindSpeed, StringFormat='{}{0}kts'}"/>
												</TextBlock>
											</StackPanel>

											<StackPanel Grid.Row="0" Grid.Column="2">
												<TextBlock Classes="label" Text="VISIBILITY"/>
												<TextBlock Text="{Binding WeatherSummary.Visibility}"
														  FontSize="20"
														  Foreground="{DynamicResource AppText}"/>
											</StackPanel>

											<StackPanel Grid.Row="1" Grid.Column="0">
												<TextBlock Classes="label" Text="ALTIMETER"/>
												<TextBlock Text="{Binding WeatherSummary.Altimeter, StringFormat='{}{0:F2} inHg'}"
														  FontSize="18"
														  Foreground="{DynamicResource AppText}"/>
											</StackPanel>


											<StackPanel Grid.Row="1" Grid.Column="1" IsVisible="{Binding WeatherSummary.DensityAltitude, Converter={x:Static ObjectConverters.IsNotNull}}">
												<TextBlock Classes="label" Text="DENSITY ALT"/>
												<TextBlock Text="{Binding WeatherSummary.DensityAltitude, StringFormat='{}{0}ft'}"
														  FontSize="18"
														  Foreground="{DynamicResource AppText}"/>
											</StackPanel>
										</Grid>

										<TextBlock Text="{Binding LastUpdateTime, StringFormat='Last updated: {0}'}"
												  Foreground="{DynamicResource AppTextQuaternary}"
												  FontSize="12"
												  HorizontalAlignment="Right"/>
									</StackPanel>
								</Border>

								<!-- Runway Analysis -->
								<Border Background="{DynamicResource AppSurface2}"
										CornerRadius="10"
										Padding="20"
										IsVisible="{Binding DepartureRunways.Count, Converter={StaticResource CountToBoolConverter}}">
									<StackPanel Spacing="16">
										<TextBlock Text="Runway Analysis" Classes="subheader"/>

										<StackPanel Spacing="8">
											<TextBlock Text="Select Runway" Classes="label"/>
											<ComboBox ItemsSource="{Binding DepartureRunways}"
													 SelectedItem="{Binding SelectedRunway}"
													 HorizontalAlignment="Stretch"
													 Background="{DynamicResource AppSurface}"
													 Foreground="{DynamicResource AppText}"
													 BorderBrush="{DynamicResource AppBorder}"
													 Padding="12"
													 Height="44"/>

											<TextBlock Text="{Binding AutoSelectedRunwayInfo}"
													  FontSize="11"
													  Foreground="{DynamicResource AppTextTertiary}"
													  FontStyle="Italic"
													  Margin="0,4,0,0"
													  IsVisible="{Binding ShowAutoSelectedInfo}"/>
										</StackPanel>

										<Border Background="{DynamicResource AppSurface}"
											   CornerRadius="8"
											   Padding="16"
											   IsVisible="{Binding SelectedRunwayData, Converter={x:Static ObjectConverters.IsNotNull}}">
											<Grid ColumnDefinitions="Auto,*,Auto,*" RowDefinitions="Auto,Auto" ColumnSpacing="16" RowSpacing="8">
												<TextBlock Grid.Row="0" Grid.Column="0"
														  Text="Type:"
														  FontSize="12"
														  Foreground="{DynamicResource AppTextTertiary}"/>
												<TextBlock Grid.Row="0" Grid.Column="1"
														  Text="{Binding SelectedRunwayData.RunwayType}"
														  FontSize="12"
														  FontWeight="SemiBold"
														  Foreground="{DynamicResource AppText}"/>

												<TextBlock Grid.Row="0" Grid.Column="2"
														  Text="Surface:"
														  FontSize="12"
														  Foreground="{DynamicResource AppTextTertiary}"/>
												<TextBlock Grid.Row="0" Grid.Column="3"
														  Text="{Binding SelectedRunwayData.Surface}"
														  FontSize="12"
														  FontWeight="SemiBold"
														  Foreground="{DynamicResource AppText}"/>

												<TextBlock Grid.Row="1" Grid.Column="0"
														  Text="Length:"
														  FontSize="12"
														  Foreground="{DynamicResource AppTextTertiary}"/>
												<TextBlock Grid.Row="1" Grid.Column="1"
														  Text="{Binding SelectedRunwayData.LengthFeet, StringFormat='{}{0:N0} ft'}"
														  FontSize="12"
														  FontWeight="SemiBold"
														  Foreground="{DynamicResource AppText}"/>

												<TextBlock Grid.Row="1" Grid.Column="2"
														  Text="Width:"
														  FontSize="12"
														  Foreground="{DynamicResource AppTextTertiary}"/>
												<TextBlock Grid.Row="1" Grid.Column="3"
														  Text="{Binding SelectedRunwayData.WidthFeet, StringFormat='{}{0} ft'}"
														  FontSize="12"
														  FontWeight="SemiBold"
														  Foreground="{DynamicResource AppText}"/>
											</Grid>
										</Border>

										<Grid ColumnDefinitions="*,*" ColumnSpacing="16">
											<StackPanel Grid.Column="0">
												<TextBlock Classes="label" Text="HEADWIND"/>
												<TextBlock Text="{Binding HeadwindDisplay}"
														  FontSize="20"
														  FontWeight="SemiBold"
														  Foreground="{Binding HeadwindColor}"/>
											</StackPanel>

											<StackPanel Grid.Column="1">
												<TextBlock Classes="label" Text="CROSSWIND"/>
												<TextBlock Text="{Binding CrosswindComponent, StringFormat='{}{0}kts'}"
														  FontSize="20"
														  FontWeight="SemiBold"
														  Foreground="{Binding CrosswindColor}"/>
											</StackPanel>
										</Grid>

										<TextBlock Text="Wind components update automatically when runway changes"
												  FontSize="11"
												  Foreground="{DynamicResource AppTextQuaternary}"
												  HorizontalAlignment="Center"/>
									</StackPanel>
								</Border>

								<!-- Hazards -->
								<ItemsControl ItemsSource="{Binding CurrentDecision.Hazards}">
									<ItemsControl.ItemTemplate>
										<DataTemplate>
											<Border Background="#fee2e2"
												   BorderBrush="#dc2626"
												   BorderThickness="1"
												   CornerRadius="8"
												   Padding="16"
												   Margin="0,8">
												<StackPanel Spacing="8">
													<StackPanel Orientation="Horizontal" Spacing="8">
														<TextBlock Text="&#x26A0;&#xFE0F; WARNING:" FontSize="16" FontWeight="Bold"/>
														<TextBlock Text="{Binding Type}"
																  FontWeight="SemiBold"
																  FontSize="16"
																  Foreground="#991b1b"/>
													</StackPanel>
													<TextBlock Text="{Binding Description}"
															  Foreground="#991b1b"
															  TextWrapping="Wrap"/>
													<TextBlock Text="{Binding QuickTip}"
															  Foreground="#b91c1c"
															  FontSize="12"
															  Opacity="0.9"
															  TextWrapping="Wrap"
															  Margin="0,4,0,0"/>
												</StackPanel>
											</Border>
										</DataTemplate>
									</ItemsControl.ItemTemplate>
								</ItemsControl>

								<!-- Recommendations -->
								<Border Background="{DynamicResource AppSurface2}" CornerRadius="10" Padding="20"
									   IsVisible="{Binding CurrentDecision.Recommendations.Count, Converter={StaticResource CountToBoolConverter}}">
									<StackPanel Spacing="12">
										<TextBlock Text="Recommendations" Classes="subheader"/>
										<ItemsControl ItemsSource="{Binding CurrentDecision.Recommendations}">
											<ItemsControl.ItemTemplate>
												<DataTemplate>
													<StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4">
														<TextBlock Text="&#x2022;" Foreground="{DynamicResource AppTextTertiary}"/>
														<TextBlock Text="{Binding}"
																  Foreground="{DynamicResource AppTextSecondary}"
																  TextWrapping="Wrap"/>
													</StackPanel>
												</DataTemplate>
											</ItemsControl.ItemTemplate>
										</ItemsControl>
									</StackPanel>
								</Border>

								<!-- Advanced Mode Toggle -->
								<Button Classes="secondary"
								   Click="ToggleAdvanced_Click"
								   HorizontalAlignment="Left">
									<StackPanel Orientation="Horizontal" Spacing="8">
										<TextBlock Text="{Binding ShowAdvancedMode, Converter={StaticResource BoolToExpandIconConverter}}"/>
										<TextBlock Text="Advanced Details"/>
									</StackPanel>
								</Button>

								<!-- Advanced Mode Content -->
								<StackPanel Spacing="16" IsVisible="{Binding ShowAdvancedMode}">
									<Border Background="{DynamicResource AppSurface2}" CornerRadius="10" Padding="20">
										<StackPanel Spacing="8">
											<TextBlock Classes="label" Text="RAW METAR"/>
											<TextBox Text="{Binding WeatherSummary.RawMetar}"
													IsReadOnly="True"
													TextWrapping="Wrap"
													Background="{DynamicResource AppSurface}"
													Foreground="#22d3ee"
													FontFamily="Consolas,Courier New"
													FontSize="13"
													Padding="12"/>
										</StackPanel>
									</Border>

									<Border Background="{DynamicResource AppSurface2}" CornerRadius="10" Padding="20"
										   IsVisible="{Binding WeatherSummary.RawTaf, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
										<StackPanel Spacing="8">
											<TextBlock Classes="label" Text="RAW TAF"/>
											<TextBox Text="{Binding WeatherSummary.RawTaf}"
													IsReadOnly="True"
													TextWrapping="Wrap"
													Background="{DynamicResource AppSurface}"
													Foreground="#a78bfa"
													FontFamily="Consolas,Courier New"
													FontSize="13"
													Padding="12"/>
										</StackPanel>
									</Border>
								</StackPanel>

							</StackPanel>
						</ScrollViewer>

						<!-- Empty State -->
						<StackPanel HorizontalAlignment="Center"
								   VerticalAlignment="Center"
								   Spacing="16"
								   IsVisible="{Binding !ShowResults}"
								   Opacity="0.5">
							<TextBlock Text="&#x2708;&#xFE0F;"
									  FontSize="64"
									  HorizontalAlignment="Center"/>
							<TextBlock Text="Enter flight details and check weather"
									  Classes="subheader"
									  HorizontalAlignment="Center"
									  Opacity="0.7"/>
						</StackPanel>
					</Grid>
				</Border>
			</Grid>
		</Grid>

		<!-- Theme Toggle Button -->
		<!--Dirty quick patch-->
		<!--
		<Canvas HorizontalAlignment="Right"
				VerticalAlignment="Bottom"
				Margin="0,0,40,40">

			<Border Width="56"
					Height="56"
					CornerRadius="28"
					ClipToBounds="True"
					BoxShadow="0 4 12 0 #00000040">

				<Button Click="ToggleTheme_Click"
						ToolTip.Tip="Toggle Dark/Light Mode"
						Width="56"
						Height="56"
						CornerRadius="28"
						Background="{DynamicResource ThemeButtonBg}"
						BorderBrush="{DynamicResource ThemeButtonBorder}"
						BorderThickness="2"
						Cursor="Hand">

					<Button.Styles>
						<Style Selector="Button:pointerover">
							<Setter Property="Background" Value="{DynamicResource AppSurface2}"/>
							<Setter Property="BorderBrush" Value="#4f46e5"/>
						</Style>
						<Style Selector="Button:pressed">
							<Setter Property="Background" Value="{DynamicResource AppBorder}"/>
						</Style>
					</Button.Styles>

					<TextBlock Text="{Binding IsDarkMode, Converter={StaticResource BoolToThemeIconConverter}}"
							   FontSize="24"
							   VerticalAlignment="Center"
							   HorizontalAlignment="Center"/>
				</Button>
			</Border>
		</Canvas>
		-->
	</Grid>
</Window>