<?xml version="1.0" encoding="utf-8"?>
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:FlightAdvisor.ViewModels"
        xmlns:converters="using:FlightAdvisor.Converters"
        xmlns:ui="using:FluentAvalonia.UI.Controls"
        x:Class="FlightAdvisor.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Flight Advisor"
        Width="1400"
        Height="900"
        WindowStartupLocation="CenterScreen"
        TransparencyLevelHint="AcrylicBlur">

	<Window.Resources>
		<converters:BoolToChevronConverter x:Key="BoolToChevronConverter"/>
		<!-- Theme Resources - Dark Mode (Default) -->
		<SolidColorBrush x:Key="AppBackground" Color="#0a0e1a"/>
		<SolidColorBrush x:Key="AppGradient1" Color="#0a0e1a"/>
		<SolidColorBrush x:Key="AppGradient2" Color="#1e293b"/>
		<SolidColorBrush x:Key="AppSurface" Color="#0f172a"/>
		<SolidColorBrush x:Key="AppSurface2" Color="#1e293b"/>
		<SolidColorBrush x:Key="AppBorder" Color="#334155"/>
		<SolidColorBrush x:Key="AppText" Color="#e0e7ff"/>
		<SolidColorBrush x:Key="AppTextSecondary" Color="#c7d2fe"/>
		<SolidColorBrush x:Key="AppTextTertiary" Color="#94a3b8"/>
		<SolidColorBrush x:Key="AppTextQuaternary" Color="#64748b"/>
		<SolidColorBrush x:Key="ThemeButtonBg" Color="#1e293b"/>
		<SolidColorBrush x:Key="ThemeButtonBorder" Color="#334155"/>
	</Window.Resources>

	<Window.Styles>
		<!-- Light Mode Overrides -->
		<Style Selector="Window[RequestedThemeVariant=Light]">
			<Style.Resources>
				<SolidColorBrush x:Key="AppBackground" Color="#f8fafc"/>
				<SolidColorBrush x:Key="AppGradient1" Color="#f8fafc"/>
				<SolidColorBrush x:Key="AppGradient2" Color="#e2e8f0"/>
				<SolidColorBrush x:Key="AppSurface" Color="#ffffff"/>
				<SolidColorBrush x:Key="AppSurface2" Color="#f1f5f9"/>
				<SolidColorBrush x:Key="AppBorder" Color="#cbd5e1"/>
				<SolidColorBrush x:Key="AppText" Color="#0f172a"/>
				<SolidColorBrush x:Key="AppTextSecondary" Color="#334155"/>
				<SolidColorBrush x:Key="AppTextTertiary" Color="#64748b"/>
				<SolidColorBrush x:Key="AppTextQuaternary" Color="#94a3b8"/>
				<SolidColorBrush x:Key="ThemeButtonBg" Color="#e2e8f0"/>
				<SolidColorBrush x:Key="ThemeButtonBorder" Color="#cbd5e1"/>
			</Style.Resources>
		</Style>

		<Style Selector="TextBlock.header">
			<Setter Property="FontSize" Value="24"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="{DynamicResource AppText}"/>
		</Style>

		<Style Selector="TextBlock.subheader">
			<Setter Property="FontSize" Value="16"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="Foreground" Value="{DynamicResource AppTextSecondary}"/>
		</Style>

		<Style Selector="TextBlock.label">
			<Setter Property="FontSize" Value="12"/>
			<Setter Property="Foreground" Value="{DynamicResource AppTextTertiary}"/>
			<Setter Property="Margin" Value="0,0,0,4"/>
		</Style>

		<Style Selector="Button.primary">
			<Setter Property="Background" Value="#4f46e5"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="Padding" Value="24,12"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="FontSize" Value="15"/>
		</Style>

		<Style Selector="Button.primary:pointerover">
			<Setter Property="Background" Value="#6366f1"/>
		</Style>

		<Style Selector="Button.secondary">
			<Setter Property="Background" Value="{DynamicResource AppSurface2}"/>
			<Setter Property="Foreground" Value="{DynamicResource AppText}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource AppBorder}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="16,8"/>
			<Setter Property="CornerRadius" Value="6"/>
		</Style>
	</Window.Styles>

	<!-- Part 2: Main Grid and Left Panel -->
	<Grid>
		<!-- Background with gradient -->
		<Border>
			<Border.Background>
				<LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
					<GradientStop Color="{Binding Source={StaticResource AppGradient1}, Path=Color}" Offset="0"/>
					<GradientStop Color="{Binding Source={StaticResource AppGradient2}, Path=Color}" Offset="1"/>
				</LinearGradientBrush>
			</Border.Background>
		</Border>

		<!-- Main Content with fade-in animation -->
		<Grid Margin="40" Name="MainContent">
			<Grid.Styles>
				<Style Selector="Grid#MainContent">
					<Style.Animations>
						<Animation Duration="0:0:0.8" FillMode="Forward">
							<KeyFrame Cue="0%">
								<Setter Property="Opacity" Value="0"/>
								<Setter Property="TranslateTransform.Y" Value="20"/>
							</KeyFrame>
							<KeyFrame Cue="100%">
								<Setter Property="Opacity" Value="1"/>
								<Setter Property="TranslateTransform.Y" Value="0"/>
							</KeyFrame>
						</Animation>
					</Style.Animations>
				</Style>
			</Grid.Styles>

			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- Header -->
			<StackPanel Grid.Row="0" Margin="0,0,0,30">
				<TextBlock Classes="header" Text="Flight Advisor"/>
				<TextBlock Classes="subheader"
                          Text="Should I Go Flying Today?"
                          Margin="0,8,0,0"
                          Opacity="0.8"/>
			</StackPanel>

			<!-- Main Input/Output Area -->
			<Grid Grid.Row="1">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="400"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<!-- Left Panel - Input -->
				<Border Grid.Column="0"
                       Background="{DynamicResource AppSurface}"
                       CornerRadius="12"
                       Padding="24"
                       BoxShadow="0 4 20 0 #00000040">

					<Grid RowDefinitions="*,Auto">
						<!-- Scrollable Input Section -->
						<ScrollViewer Grid.Row="0">
							<StackPanel Spacing="20">

								<!-- Flight Type Selection -->
								<StackPanel Spacing="12">
									<TextBlock Text="Flight Type"
									           FontSize="14"
									           FontWeight="SemiBold"
									           Foreground="{DynamicResource AppText}"/>

									<ComboBox ItemsSource="{Binding FlightTypes}"
									          SelectedItem="{Binding SelectedFlightType}"
									          PlaceholderText="Select flight type"
									          HorizontalAlignment="Stretch"
									          Background="{DynamicResource AppSurface2}"
									          Foreground="{DynamicResource AppText}"
									          BorderBrush="{DynamicResource AppBorder}"
									          Padding="12"
									          Height="44"/>
								</StackPanel>

								<!-- Aircraft Selection -->
								<StackPanel Spacing="12">
									<TextBlock Text="Aircraft"
									           FontSize="14"
									           FontWeight="SemiBold"
									           Foreground="{DynamicResource AppText}"/>

									<ComboBox ItemsSource="{Binding AllAircraft}"
									          SelectedItem="{Binding SelectedAircraft}"
									          PlaceholderText="Select aircraft"
									          HorizontalAlignment="Stretch"
									          Background="{DynamicResource AppSurface2}"
									          Foreground="{DynamicResource AppText}"
									          BorderBrush="{DynamicResource AppBorder}"
									          Padding="12"
									          Height="44">
										<ComboBox.ItemTemplate>
											<DataTemplate>
												<TextBlock Text="{Binding Name}"/>
											</DataTemplate>
										</ComboBox.ItemTemplate>
									</ComboBox>
								</StackPanel>

								<!-- Airport Codes -->
								<Grid ColumnDefinitions="*,*,*" ColumnSpacing="16">
									<StackPanel Grid.Column="0" Spacing="8">
										<TextBlock Text="Departure"
										           FontSize="13"
										           Foreground="{DynamicResource AppTextTertiary}"/>
										<TextBox Text="{Binding DepartureIcao}"
										         Watermark="KJFK"
										         MaxLength="4"
										         Background="{DynamicResource AppSurface2}"
										         Foreground="{DynamicResource AppText}"
										         BorderBrush="{DynamicResource AppBorder}"
										         Padding="12"
										         Height="44"
										         FontSize="14"
										         VerticalContentAlignment="Center"/>
									</StackPanel>

									<StackPanel Grid.Column="1" Spacing="8">
										<TextBlock Text="Arrival (Opt)"
										           FontSize="13"
										           Foreground="{DynamicResource AppTextTertiary}"/>
										<TextBox Text="{Binding ArrivalIcao}"
										         Watermark="KEWR"
										         MaxLength="4"
										         Background="{DynamicResource AppSurface2}"
										         Foreground="{DynamicResource AppText}"
										         BorderBrush="{DynamicResource AppBorder}"
										         Padding="12"
										         Height="44"
										         FontSize="14"
										         VerticalContentAlignment="Center"/>
									</StackPanel>

									<StackPanel Grid.Column="2" Spacing="8">
										<TextBlock Text="Alternate (Opt)"
										           FontSize="13"
										           Foreground="{DynamicResource AppTextTertiary}"/>
										<TextBox Text="{Binding AlternateIcao}"
										         Watermark="KLGA"
										         MaxLength="4"
										         Background="{DynamicResource AppSurface2}"
										         Foreground="{DynamicResource AppText}"
										         BorderBrush="{DynamicResource AppBorder}"
										         Padding="12"
										         Height="44"
										         FontSize="14"
										         VerticalContentAlignment="Center"/>
									</StackPanel>
								</Grid>

								<Border Background="{DynamicResource AppSurface2}"
								        CornerRadius="8"
								        Padding="20"
								        BorderBrush="{DynamicResource AppBorder}"
								        BorderThickness="1">
									<StackPanel Spacing="16">

										<Grid ColumnDefinitions="*,Auto">
											<TextBlock Grid.Column="0"
											           Text="Flight Details (Optional)"
											           FontSize="16"
											           FontWeight="SemiBold"
											           Foreground="{DynamicResource AppText}"
											           VerticalAlignment="Center"/>

											<Button Grid.Column="1"
											        Click="ToggleFlightDetails_Click"
											        Background="Transparent"
											        BorderThickness="0"
											        Foreground="{DynamicResource AppTextTertiary}"
											        FontSize="20"
											        Padding="8"
											        Cursor="Hand">
												<TextBlock Text="{Binding ShowFlightDetails, Converter={StaticResource BoolToChevronConverter}}"/>
											</Button>
										</Grid>

										<StackPanel Spacing="16" IsVisible="{Binding ShowFlightDetails}">

											<Grid ColumnDefinitions="*,*,*" ColumnSpacing="16">
												<StackPanel Grid.Column="0" Spacing="8">
													<TextBlock Text="Takeoff Weight"
													           FontSize="13"
													           Foreground="{DynamicResource AppTextTertiary}"/>
													<NumericUpDown Value="{Binding TakeoffWeight}"
													               Minimum="0"
													               Maximum="999999"
													               Watermark="0"
													               Background="{DynamicResource AppSurface}"
													               Foreground="{DynamicResource AppText}"
													               BorderBrush="{DynamicResource AppBorder}"
													               Padding="12"
													               Height="44"/>
												</StackPanel>

												<StackPanel Grid.Column="1" Spacing="8">
													<TextBlock Text="Landing Weight"
													           FontSize="13"
													           Foreground="{DynamicResource AppTextTertiary}"/>
													<NumericUpDown Value="{Binding LandingWeight}"
													               Minimum="0"
													               Maximum="999999"
													               Watermark="0"
													               Background="{DynamicResource AppSurface}"
													               Foreground="{DynamicResource AppText}"
													               BorderBrush="{DynamicResource AppBorder}"
													               Padding="12"
													               Height="44"/>
												</StackPanel>

												<StackPanel Grid.Column="2" Spacing="8">
													<TextBlock Text="Souls on Board"
													           FontSize="13"
													           Foreground="{DynamicResource AppTextTertiary}"/>
													<NumericUpDown Value="{Binding SoulsOnBoard}"
													               Minimum="0"
													               Maximum="999"
													               Watermark="0"
													               Background="{DynamicResource AppSurface}"
													               Foreground="{DynamicResource AppText}"
													               BorderBrush="{DynamicResource AppBorder}"
													               Padding="12"
													               Height="44"/>
												</StackPanel>
											</Grid>

											<StackPanel Spacing="8">
												<TextBlock Text="Fuel Planned (gal)"
												           FontSize="13"
												           Foreground="{DynamicResource AppTextTertiary}"/>
												<NumericUpDown Value="{Binding FuelPlanned}"
												               Minimum="0"
												               Maximum="99999"
												               Watermark="0.0"
												               FormatString="F1"
												               Background="{DynamicResource AppSurface}"
												               Foreground="{DynamicResource AppText}"
												               BorderBrush="{DynamicResource AppBorder}"
												               Padding="12"
												               Height="44"/>
											</StackPanel>

											<StackPanel Spacing="8">
												<TextBlock Text="Route"
												           FontSize="13"
												           Foreground="{DynamicResource AppTextTertiary}"/>
												<TextBox Text="{Binding Route}"
												         Watermark="DCT or specify waypoints"
												         AcceptsReturn="True"
												         TextWrapping="Wrap"
												         MinHeight="100"
												         Background="{DynamicResource AppSurface}"
												         Foreground="{DynamicResource AppText}"
												         BorderBrush="{DynamicResource AppBorder}"
												         Padding="12"
												         FontSize="14"
												         VerticalAlignment="Top"/>
											</StackPanel>

											<TextBlock Text="Runway selections will be used for crosswind calculations"
											           FontSize="12"
											           Foreground="{DynamicResource AppTextQuaternary}"
											           TextAlignment="Center"
											           Margin="0,8,0,0"/>
										</StackPanel>
									</StackPanel>
								</Border>

						</StackPanel>
					</ScrollViewer>

						<!-- BOTTOM SECTION - CHECK WEATHER BUTTON -->
						<StackPanel Grid.Row="1" Spacing="12" Margin="0,20,0,0">
						<!-- Check Weather Button -->
						<Button Content="Check Weather Conditions"
						        Click="CheckWeather_Click"
						        HorizontalAlignment="Stretch"
						        Height="48"
						        FontSize="16"
						        FontWeight="SemiBold"
						        Background="#4f46e5"
						        Foreground="White"
						        CornerRadius="8"
						        Cursor="Hand"
						        IsVisible="{Binding DepartureIcao, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
							<Button.Styles>
								<Style Selector="Button:pointerover">
									<Setter Property="Background" Value="#4338ca"/>
								</Style>
								<Style Selector="Button:pressed">
									<Setter Property="Background" Value="#3730a3"/>
								</Style>
							</Button.Styles>
						</Button>
					</StackPanel>
				</Grid>
			</Border>

				<!-- RIGHT PANEL - See Part 4 -->
			<!-- Right Panel - Results -->
				<Border Grid.Column="1"
                       Margin="24,0,0,0"
                       Background="{DynamicResource AppSurface}"
                       CornerRadius="12"
                       Padding="32"
                       BoxShadow="0 4 20 0 #00000040">

					<Grid>
						<!-- Loading State -->
						<StackPanel HorizontalAlignment="Center"
								   VerticalAlignment="Center"
								   IsVisible="{Binding IsLoading}"
								   Spacing="16">
							<ui:ProgressRing IsActive="True" Width="48" Height="48"/>
							<TextBlock Text="Fetching weather data..."
									  Classes="subheader"
									  HorizontalAlignment="Center"/>
						</StackPanel>

						<!-- Error State -->
						<Border IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
							   Background="#fee2e2"
							   BorderBrush="#dc2626"
							   BorderThickness="1"
							   CornerRadius="8"
							   Padding="20">
							<StackPanel Spacing="12">
								<TextBlock Text="Error"
										  FontSize="18"
										  FontWeight="SemiBold"
										  Foreground="#991b1b"/>
								<TextBlock Text="{Binding ErrorMessage}"
										  Foreground="#991b1b"
										  TextWrapping="Wrap"/>
							</StackPanel>
						</Border>

						<!-- Results Display -->
						<ScrollViewer IsVisible="{Binding ShowResults}">
							<StackPanel Spacing="24">

								<!-- Decision Header -->
								<Border CornerRadius="12" Padding="24">
									<Border.Background>
										<SolidColorBrush Color="{Binding CurrentDecision.Decision, Converter={StaticResource DecisionToColorConverter}}"/>
									</Border.Background>

									<StackPanel Spacing="12">
										<TextBlock Text="{Binding CurrentDecision.Decision, Converter={StaticResource DecisionToTextConverter}}"
												  FontSize="28"
												  FontWeight="Bold"
												  Foreground="White"/>
										<TextBlock Text="{Binding CurrentDecision.Summary}"
												  FontSize="16"
												  Foreground="White"
												  Opacity="0.95"
												  TextWrapping="Wrap"/>
									</StackPanel>
								</Border>

								<!-- Weather Summary -->
								<Border Background="{DynamicResource AppSurface2}"
									   CornerRadius="10"
									   Padding="20">
									<StackPanel Spacing="16">
										<StackPanel Orientation="Horizontal" Spacing="12">
											<TextBlock Text="Airport:" FontSize="16" FontWeight="SemiBold"/>
											<TextBlock Classes="subheader"
													  Text="{Binding WeatherSummary.AirportName}"
													  VerticalAlignment="Center"/>
											<TextBlock Text="{Binding WeatherSummary.AirportIcao, StringFormat='({0})'}"
													  Foreground="{DynamicResource AppTextTertiary}"
													  VerticalAlignment="Center"/>
										</StackPanel>

										<Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="20" RowSpacing="12">
											<StackPanel Grid.Row="0" Grid.Column="0">
												<TextBlock Classes="label" Text="TEMPERATURE"/>
												<TextBlock Text="{Binding WeatherSummary.Temperature, StringFormat='{}{0:F1}°C'}"
														  FontSize="24"
														  FontWeight="SemiBold"
														  Foreground="{DynamicResource AppText}"/>
											</StackPanel>

											<StackPanel Grid.Row="0" Grid.Column="1">
												<TextBlock Classes="label" Text="WIND"/>
												<TextBlock FontSize="20" Foreground="{DynamicResource AppText}">
													<Run Text="{Binding WeatherSummary.WindDirection, StringFormat='{}{0}°'}"/>
													<Run Text=" at "/>
													<Run Text="{Binding WeatherSummary.WindSpeed, StringFormat='{}{0}kts'}"/>
												</TextBlock>
											</StackPanel>

											<StackPanel Grid.Row="0" Grid.Column="2">
												<TextBlock Classes="label" Text="VISIBILITY"/>
												<TextBlock Text="{Binding WeatherSummary.Visibility}"
														  FontSize="20"
														  Foreground="{DynamicResource AppText}"/>
											</StackPanel>

											<StackPanel Grid.Row="1" Grid.Column="0">
												<TextBlock Classes="label" Text="ALTIMETER"/>
												<TextBlock Text="{Binding WeatherSummary.Altimeter, StringFormat='{}{0:F2} inHg'}"
														  FontSize="18"
														  Foreground="{DynamicResource AppText}"/>
											</StackPanel>

											<StackPanel Grid.Row="1" Grid.Column="1" IsVisible="{Binding WeatherSummary.CrosswindComponent, Converter={x:Static ObjectConverters.IsNotNull}}">
												<TextBlock Classes="label" Text="CROSSWIND"/>
												<TextBlock Text="{Binding WeatherSummary.CrosswindComponent, StringFormat='{}{0}kts'}"
														  FontSize="18"
														  Foreground="#f59e0b"/>
											</StackPanel>

											<StackPanel Grid.Row="1" Grid.Column="2" IsVisible="{Binding WeatherSummary.DensityAltitude, Converter={x:Static ObjectConverters.IsNotNull}}">
												<TextBlock Classes="label" Text="DENSITY ALT"/>
												<TextBlock Text="{Binding WeatherSummary.DensityAltitude, StringFormat='{}{0}ft'}"
														  FontSize="18"
														  Foreground="{DynamicResource AppText}"/>
											</StackPanel>
										</Grid>

										<TextBlock Text="{Binding LastUpdateTime, StringFormat='Last updated: {0}'}"
												  Foreground="{DynamicResource AppTextQuaternary}"
												  FontSize="12"
												  HorizontalAlignment="Right"/>
									</StackPanel>
								</Border>

								<Border Background="{DynamicResource AppSurface2}"
									   CornerRadius="10"
									   Padding="20"
									   IsVisible="{Binding DepartureRunways.Count, Converter={StaticResource CountToBoolConverter}}">
									<StackPanel Spacing="16">
										<TextBlock Text="Runway Analysis"
												  Classes="subheader"/>

										<StackPanel Spacing="8">
											<TextBlock Text="Select Runway"
													  Classes="label"/>
											<ComboBox ItemsSource="{Binding DepartureRunways}"
													 SelectedItem="{Binding SelectedRunway}"
													 HorizontalAlignment="Stretch"
													 Background="{DynamicResource AppSurface}"
													 Foreground="{DynamicResource AppText}"
													 BorderBrush="{DynamicResource AppBorder}"
													 Padding="12"
													 Height="44"/>
										</StackPanel>

										<Grid ColumnDefinitions="*,*" ColumnSpacing="16">
											<StackPanel Grid.Column="0">
												<TextBlock Classes="label" Text="HEADWIND"/>
												<TextBlock Text="{Binding HeadwindComponent, StringFormat='{}{0}kts'}"
														  FontSize="20"
														  FontWeight="SemiBold"
														  Foreground="#22c55e"/>
											</StackPanel>

											<StackPanel Grid.Column="1">
												<TextBlock Classes="label" Text="CROSSWIND"/>
												<TextBlock Text="{Binding CrosswindComponent, StringFormat='{}{0}kts'}"
														  FontSize="20"
														  FontWeight="SemiBold"
														  Foreground="#f59e0b"/>
											</StackPanel>
										</Grid>

										<TextBlock Text="Wind components update automatically when runway changes"
												  FontSize="11"
												  Foreground="{DynamicResource AppTextQuaternary}"
												  HorizontalAlignment="Center"/>
									</StackPanel>
								</Border>

								<ItemsControl ItemsSource="{Binding CurrentDecision.Hazards}">
									<ItemsControl.ItemTemplate>
										<DataTemplate>
											<Border Background="#fee2e2"
												   BorderBrush="#dc2626"
												   BorderThickness="1"
												   CornerRadius="8"
												   Padding="16"
												   Margin="0,8">
												<StackPanel Spacing="8">
													<StackPanel Orientation="Horizontal" Spacing="8">
														<TextBlock Text="WARNING:" FontSize="16" FontWeight="Bold"/>
														<TextBlock Text="{Binding Type}"
																  FontWeight="SemiBold"
																  FontSize="16"
																  Foreground="#991b1b"/>
													</StackPanel>
													<TextBlock Text="{Binding Description}"
															  Foreground="#991b1b"
															  TextWrapping="Wrap"/>
													<TextBlock Text="{Binding QuickTip}"
															  Foreground="#b91c1c"
															  FontSize="12"
															  Opacity="0.9"
															  TextWrapping="Wrap"
															  Margin="0,4,0,0"/>
												</StackPanel>
											</Border>
										</DataTemplate>
									</ItemsControl.ItemTemplate>
								</ItemsControl>
								
								<!-- Recommendations -->
								<Border Background="{DynamicResource AppSurface2}" CornerRadius="10" Padding="20"
									   IsVisible="{Binding CurrentDecision.Recommendations.Count, Converter={StaticResource CountToBoolConverter}}">
									<StackPanel Spacing="12">
										<TextBlock Text="Recommendations"
												  Classes="subheader"/>
										<ItemsControl ItemsSource="{Binding CurrentDecision.Recommendations}">
											<ItemsControl.ItemTemplate>
												<DataTemplate>
													<StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4">
														<TextBlock Text="•" Foreground="{DynamicResource AppTextTertiary}"/>
														<TextBlock Text="{Binding}"
																  Foreground="{DynamicResource AppTextSecondary}"
																  TextWrapping="Wrap"/>
													</StackPanel>
												</DataTemplate>
											</ItemsControl.ItemTemplate>
										</ItemsControl>
									</StackPanel>
								</Border>

								<!-- Advanced Mode Toggle -->
								<Button Classes="secondary"
								   Click="ToggleAdvanced_Click"
								   HorizontalAlignment="Left">
									<StackPanel Orientation="Horizontal" Spacing="8">
										<TextBlock Text="{Binding ShowAdvancedMode, Converter={StaticResource BoolToExpandIconConverter}}"/>
										<TextBlock Text="Advanced Details"/>
									</StackPanel>
								</Button>

								<!-- Advanced Mode Content -->
								<StackPanel Spacing="16" IsVisible="{Binding ShowAdvancedMode}">
									<Border Background="{DynamicResource AppSurface2}" CornerRadius="10" Padding="20">
										<StackPanel Spacing="8">
											<TextBlock Classes="label" Text="RAW METAR"/>
											<TextBox Text="{Binding WeatherSummary.RawMetar}"
													IsReadOnly="True"
													TextWrapping="Wrap"
													Background="{DynamicResource AppSurface}"
													Foreground="#22d3ee"
													FontFamily="Consolas,Courier New"
													FontSize="13"
													Padding="12"/>
										</StackPanel>
									</Border>

									<Border Background="{DynamicResource AppSurface2}" CornerRadius="10" Padding="20"
										   IsVisible="{Binding WeatherSummary.RawTaf, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
										<StackPanel Spacing="8">
											<TextBlock Classes="label" Text="RAW TAF"/>
											<TextBox Text="{Binding WeatherSummary.RawTaf}"
													IsReadOnly="True"
													TextWrapping="Wrap"
													Background="{DynamicResource AppSurface}"
													Foreground="#a78bfa"
													FontFamily="Consolas,Courier New"
													FontSize="13"
													Padding="12"/>
										</StackPanel>
									</Border>
								</StackPanel>

							</StackPanel>
						</ScrollViewer>

						<!-- Empty State -->
						<StackPanel HorizontalAlignment="Center"
								   VerticalAlignment="Center"
								   Spacing="16"
								   IsVisible="{Binding !ShowResults}"
								   Opacity="0.5">
							<TextBlock Text="[Airplane Icon]"
									  FontSize="64"
									  HorizontalAlignment="Center"/>
							<TextBlock Text="Enter flight details and check weather"
									  Classes="subheader"
									  HorizontalAlignment="Center"
									  Opacity="0.7"/>
						</StackPanel>
					</Grid>
				</Border>
			</Grid>
		</Grid>
		<Canvas HorizontalAlignment="Right"
				VerticalAlignment="Bottom"
				Margin="0,0,40,40">

			<Border Width="56"
					Height="56"
					CornerRadius="28"
					ClipToBounds="True"
					BoxShadow="0 4 12 0 #00000040">

				<Button Click="ToggleTheme_Click"
						ToolTip.Tip="Toggle Dark/Light Mode"
						Width="56"
						Height="56"
						CornerRadius="28"
						Background="{DynamicResource ThemeButtonBg}"
						BorderBrush="{DynamicResource ThemeButtonBorder}"
						BorderThickness="2"
						Cursor="Hand">

					<Button.Styles>
						<Style Selector="Button:pointerover">
							<Setter Property="Background" Value="{DynamicResource AppSurface2}"/>
							<Setter Property="BorderBrush" Value="#4f46e5"/>
						</Style>
						<Style Selector="Button:pressed">
							<Setter Property="Background" Value="{DynamicResource AppBorder}"/>
						</Style>
					</Button.Styles>

					<TextBlock Text="{Binding IsDarkMode, Converter={StaticResource BoolToThemeIconConverter}}"
							   FontSize="24"
							   VerticalAlignment="Center"
							   HorizontalAlignment="Center"/>
				</Button>
			</Border>
		</Canvas>
	</Grid>
</Window>